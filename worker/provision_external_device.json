{
    "name": "provision_external_device",
    "description": "Submit device configuration settings",
    "ephemeral": true,
    "version": 1,
    "tasks": [
        {
            "name": "set_external_id",
            "type": "http",
            "retries": 3,
            "http": {
                "uri": "http://${env.DEVICEAUTH_ADDR|mender-device-auth:8080}/api/internal/v1/devauth/tenants/${workflow.input.tenant_id}/devices/${workflow.input.device_id}/external",
                "method": "PUT",
                "headers": {
                    "X-MEN-Requestid": "${workflow.input.request_id}",
                    "Content-Type": "application/json"
                },
                "json": {
                    "provider": "${workflow.input.provider}",
                    "id": "${workflow.input.device_id}",
                    "name": "${workflow.input.device_name}"
                },
                "connectionTimeOut": 8000,
                "readTimeOut": 8000,
                "statusCodes": [
                    200,
                    204,
                    404
                ]
            }
        },
        {
            "name": "submit_configuration",
            "type": "http",
            "retries": 3,
            "http": {
                "requires": [
                    "${env.HAVE_DEVICECONFIG}"
                ],
                "uri": "http://${env.DEVICECONFIG_ADDR|mender-deviceconfig:8080}/api/internal/v1/deviceconfig/tenants/${workflow.input.tenant_id}/configurations/device/${workflow.input.device_id}",
                "method": "PATCH",
                "headers": {
                    "X-MEN-Requestid": "${workflow.input.request_id}",
                    "Content-Type": "application/json"
                },
                "json": "${workflow.input.configuration}",
                "connectionTimeOut": 8000,
                "readTimeOut": 8000,
                "statusCodes": [
                    200,
                    204,
                    404
                ]
            }
        }
    ],
    "inputParameters": [
        "request_id",
        "tenant_id",
        "device_id",
        "provider"
    ],
    "optionalParameters": [
        "configuration",
        "device_name"
    ]
}
